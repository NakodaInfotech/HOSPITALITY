
Imports BL

Public Class SelectBills

    Public CMPNAME As String = ""
    Public BILLNO As String = ""

    Private Sub cmdcancel_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdcancel.Click
        Me.Close()
    End Sub

    Private Sub cmdok_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdok.Click
        Try
            BILLNO = gridrec.GetFocusedRowCellValue("SRNO")
            Me.Close()
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub SelectBills_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles Me.KeyDown
        Try
            If e.KeyCode = Windows.Forms.Keys.Escape Or (e.KeyCode = Keys.X And e.Alt = True) Then
                Me.Close()
            ElseIf e.KeyCode = Keys.E And e.Alt = True Then
                cmdok_Click(sender, e)
            End If
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Sub fillgrid(ByVal tepmcondition)
        Try
            Dim OBJCMN As New ClsCommon
            Dim dt As DataTable = OBJCMN.search(" * ", "", " (SELECT OPENINGBILL.BILL_INITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, OPENINGBILL.BILL_AMT AS BILLAMT, OPENINGBILL.BILL_BALANCE AS BALAMT, 'OPENING' AS TYPE, OPENINGBILL.BILL_NO AS BILLNO, OPENINGBILL.BILL_CMPID AS CMPID, OPENINGBILL.BILL_LOCATIONID AS LOCATIONID, OPENINGBILL.BILL_YEARID AS YEARID FROM OPENINGBILL INNER JOIN LEDGERS ON OPENINGBILL.BILL_LEDGERID = LEDGERS.Acc_id WHERE (OPENINGBILL.BILL_BALANCE > 0) UNION ALL SELECT HOTELBOOKINGMASTER.BOOKING_SALEBILLINITIALS AS SRNO, GUESTMASTER.GUEST_NAME AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, HOTELBOOKINGMASTER.BOOKING_GRANDTOTAL AS BILLAMT, HOTELBOOKINGMASTER.BOOKING_SALEBALANCE AS BALAMT, 'HOTELBOOKING' AS TYPE, BOOKING_NO AS BILLNO, BOOKING_CMPID AS CMPID, BOOKING_LOCATIONID AS LOCATIONID, BOOKING_YEARID AS YEARID FROM HOTELBOOKINGMASTER INNER JOIN GUESTMASTER ON HOTELBOOKINGMASTER.BOOKING_GUESTID = GUESTMASTER.GUEST_ID INNER JOIN LEDGERS ON HOTELBOOKINGMASTER.BOOKING_LEDGERID = LEDGERS.Acc_id WHERE BOOKING_CANCELLED = 'FALSE' AND BOOKING_AMD_DONE ='FALSE' AND BOOKING_SALEBALANCE > 0 UNION ALL SELECT HOTELBOOKINGMASTER.BOOKING_PURBILLINITIALS AS SRNO, GUESTMASTER.GUEST_NAME AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, HOTELBOOKINGMASTER.BOOKING_PURGRANDTOTAL AS BILLAMT, HOTELBOOKINGMASTER.BOOKING_PURBALANCE AS BALAMT, 'HOTELBOOKING' AS TYPE, BOOKING_NO AS BILLNO, BOOKING_CMPID AS CMPID, BOOKING_LOCATIONID AS LOCATIONID, BOOKING_YEARID AS YEARID FROM HOTELBOOKINGMASTER INNER JOIN GUESTMASTER ON HOTELBOOKINGMASTER.BOOKING_GUESTID = GUESTMASTER.GUEST_ID INNER JOIN LEDGERS ON HOTELBOOKINGMASTER.BOOKING_PURLEDGERID = LEDGERS.Acc_id WHERE BOOKING_CANCELLED = 'FALSE' AND BOOKING_AMD_DONE ='FALSE' AND BOOKING_PURBALANCE > 0 UNION ALL SELECT RAILBOOKINGMASTER.BOOKING_SALEBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, RAILBOOKINGMASTER.BOOKING_GRANDTOTAL AS BILLAMT, RAILBOOKINGMASTER.BOOKING_SALEBALANCE AS BALAMT, 'RAILBOOKING' AS TYPE, BOOKING_NO AS BILLNO, BOOKING_CMPID AS CMPID, BOOKING_LOCATIONID AS LOCATIONID, BOOKING_YEARID AS YEARID FROM RAILBOOKINGMASTER INNER JOIN LEDGERS ON RAILBOOKINGMASTER.BOOKING_LEDGERID = LEDGERS.Acc_id WHERE BOOKING_CANCELLED = 'FALSE' AND RAILBOOKINGMASTER.BOOKING_SALEBALANCE > 0 UNION ALL SELECT RAILBOOKINGMASTER.BOOKING_PURBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, RAILBOOKINGMASTER.BOOKING_PURGRANDTOTAL AS BILLAMT, RAILBOOKINGMASTER.BOOKING_PURBALANCE AS BALAMT, 'RAILBOOKING' AS TYPE, BOOKING_NO AS BILLNO, BOOKING_CMPID AS CMPID, BOOKING_LOCATIONID AS LOCATIONID, BOOKING_YEARID AS YEARID FROM RAILBOOKINGMASTER INNER JOIN LEDGERS ON RAILBOOKINGMASTER.BOOKING_PURLEDGERID = LEDGERS.Acc_id WHERE BOOKING_CANCELLED = 'FALSE' AND RAILBOOKINGMASTER.BOOKING_PURBALANCE > 0 UNION ALL SELECT AIRLINEBOOKINGMASTER.BOOKING_SALEBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME,  AIRLINEBOOKINGMASTER.BOOKING_GRANDTOTAL AS BILLAMT, AIRLINEBOOKINGMASTER.BOOKING_SALEBALANCE AS BALAMT, 'AIRLINEBOOKING' AS TYPE, AIRLINEBOOKINGMASTER.BOOKING_NO AS BILLNO, AIRLINEBOOKINGMASTER.BOOKING_CMPID AS CMPID, AIRLINEBOOKINGMASTER.BOOKING_LOCATIONID AS LOCATIONID, AIRLINEBOOKINGMASTER.BOOKING_YEARID AS YEARID FROM AIRLINEBOOKINGMASTER INNER JOIN LEDGERS ON AIRLINEBOOKINGMASTER.BOOKING_LEDGERID = LEDGERS.Acc_id WHERE (AIRLINEBOOKINGMASTER.BOOKING_CANCELLED = 'FALSE')  AND  (AIRLINEBOOKINGMASTER.BOOKING_SALEBALANCE > 0)  UNION ALL SELECT AIRLINEBOOKINGMASTER.BOOKING_PURBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME,  AIRLINEBOOKINGMASTER.BOOKING_PURGRANDTOTAL AS BILLAMT, AIRLINEBOOKINGMASTER.BOOKING_PURBALANCE AS BALAMT, 'AIRLINEBOOKING' AS TYPE, AIRLINEBOOKINGMASTER.BOOKING_NO AS BILLNO, AIRLINEBOOKINGMASTER.BOOKING_CMPID AS CMPID, AIRLINEBOOKINGMASTER.BOOKING_LOCATIONID AS LOCATIONID, AIRLINEBOOKINGMASTER.BOOKING_YEARID AS YEARID FROM AIRLINEBOOKINGMASTER INNER JOIN LEDGERS ON AIRLINEBOOKINGMASTER.BOOKING_PURLEDGERID = LEDGERS.Acc_id WHERE (AIRLINEBOOKINGMASTER.BOOKING_CANCELLED = 'FALSE')  AND  (AIRLINEBOOKINGMASTER.BOOKING_PURBALANCE > 0)  UNION ALL SELECT HOLIDAYPACKAGEMASTER.BOOKING_SALEBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, HOLIDAYPACKAGEMASTER.BOOKING_GRANDTOTAL AS BILLAMT, HOLIDAYPACKAGEMASTER.BOOKING_SALEBALANCE AS BALAMT, 'HOLIDAYPACKAGE' AS TYPE, BOOKING_NO AS BILLNO, BOOKING_CMPID AS CMPID, BOOKING_LOCATIONID AS LOCATIONID, BOOKING_YEARID AS YEARID FROM HOLIDAYPACKAGEMASTER INNER JOIN LEDGERS ON HOLIDAYPACKAGEMASTER.BOOKING_LEDGERID = LEDGERS.Acc_id WHERE BOOKING_CANCELLED = 'FALSE' AND BOOKING_AMD_DONE ='FALSE' AND HOLIDAYPACKAGEMASTER.BOOKING_SALEBALANCE > 0  UNION ALL SELECT HOLIDAYPACKAGEMASTER_PURCHASEDETAILS.BOOKING_PURBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, HOLIDAYPACKAGEMASTER_PURCHASEDETAILS.BOOKING_GTOTAL AS BILLAMT, HOLIDAYPACKAGEMASTER_PURCHASEDETAILS.BOOKING_BALANCE AS BALAMT, 'HOLIDAYPACKAGE' AS TYPE, HOLIDAYPACKAGEMASTER.BOOKING_NO AS BILLNO, HOLIDAYPACKAGEMASTER.BOOKING_CMPID AS CMPID, HOLIDAYPACKAGEMASTER.BOOKING_LOCATIONID AS LOCATIONID, HOLIDAYPACKAGEMASTER.BOOKING_YEARID AS YEARID FROM LEDGERS INNER JOIN HOLIDAYPACKAGEMASTER_PURCHASEDETAILS ON LEDGERS.Acc_id = HOLIDAYPACKAGEMASTER_PURCHASEDETAILS.BOOKING_PURLEDGERID INNER JOIN HOLIDAYPACKAGEMASTER ON HOLIDAYPACKAGEMASTER_PURCHASEDETAILS.BOOKING_NO = HOLIDAYPACKAGEMASTER.BOOKING_NO AND HOLIDAYPACKAGEMASTER_PURCHASEDETAILS.BOOKING_YEARID = HOLIDAYPACKAGEMASTER.BOOKING_YEARID WHERE (HOLIDAYPACKAGEMASTER.BOOKING_CANCELLED = 'FALSE') AND (HOLIDAYPACKAGEMASTER.BOOKING_AMD_DONE = 'FALSE') AND (HOLIDAYPACKAGEMASTER_PURCHASEDETAILS.BOOKING_BALANCE > 0) UNION ALL SELECT CARBOOKINGMASTER.BOOKING_SALEBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, CARBOOKINGMASTER.BOOKING_GRANDTOTAL AS BILLAMT, CARBOOKINGMASTER.BOOKING_SALEBALANCE AS BALAMT, 'VEHICLEBOOKING' AS TYPE, BOOKING_NO AS BILLNO, BOOKING_CMPID AS CMPID, BOOKING_LOCATIONID AS LOCATIONID, BOOKING_YEARID AS YEARID FROM CARBOOKINGMASTER INNER JOIN LEDGERS ON CARBOOKINGMASTER.BOOKING_LEDGERID = LEDGERS.Acc_id WHERE BOOKING_CANCELLED = 'FALSE' AND CARBOOKINGMASTER.BOOKING_SALEBALANCE > 0  UNION ALL SELECT CARBOOKINGMASTER_PURCHASEDETAILS.BOOKING_PURBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, CARBOOKINGMASTER_PURCHASEDETAILS.BOOKING_GTOTAL AS BILLAMT, CARBOOKINGMASTER_PURCHASEDETAILS.BOOKING_BALANCE AS BALAMT, 'VEHICLEBOOKING' AS TYPE, CARBOOKINGMASTER.BOOKING_NO AS BILLNO, CARBOOKINGMASTER.BOOKING_CMPID AS CMPID, CARBOOKINGMASTER.BOOKING_LOCATIONID AS LOCATIONID, CARBOOKINGMASTER.BOOKING_YEARID AS YEARID FROM LEDGERS INNER JOIN CARBOOKINGMASTER_PURCHASEDETAILS ON LEDGERS.Acc_id = CARBOOKINGMASTER_PURCHASEDETAILS.BOOKING_PURLEDGERID INNER JOIN CARBOOKINGMASTER ON CARBOOKINGMASTER_PURCHASEDETAILS.BOOKING_NO = CARBOOKINGMASTER.BOOKING_NO AND CARBOOKINGMASTER_PURCHASEDETAILS.BOOKING_YEARID = CARBOOKINGMASTER.BOOKING_YEARID WHERE (CARBOOKINGMASTER.BOOKING_CANCELLED = 'FALSE') AND (CARBOOKINGMASTER_PURCHASEDETAILS.BOOKING_BALANCE >  0)  UNION ALL SELECT VISABOOKING.BOOKING_SALEBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, VISABOOKING.BOOKING_GRANDTOTAL AS BILLAMT, VISABOOKING.BOOKING_SALEBALANCE AS BALAMT, 'VISASALE' AS TYPE, BOOKING_NO AS BILLNO, BOOKING_CMPID AS CMPID, 0 AS LOCATIONID, BOOKING_YEARID AS YEARID FROM VISABOOKING INNER JOIN LEDGERS ON VISABOOKING.BOOKING_LEDGERID = LEDGERS.Acc_id WHERE  VISABOOKING.BOOKING_SALEBALANCE > 0  UNION ALL SELECT VISABOOKING_PURCHASEDETAILS.BOOKING_PURBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, VISABOOKING_PURCHASEDETAILS.BOOKING_GTOTAL AS BILLAMT, VISABOOKING_PURCHASEDETAILS.BOOKING_BALANCE AS BALAMT, 'VISAPUR' AS TYPE, VISABOOKING.BOOKING_NO AS BILLNO, VISABOOKING.BOOKING_CMPID AS CMPID, 0 AS LOCATIONID, VISABOOKING.BOOKING_YEARID AS YEARID FROM LEDGERS INNER JOIN VISABOOKING_PURCHASEDETAILS ON LEDGERS.Acc_id = VISABOOKING_PURCHASEDETAILS.BOOKING_PURLEDGERID INNER JOIN VISABOOKING ON VISABOOKING_PURCHASEDETAILS.BOOKING_NO = VISABOOKING.BOOKING_NO AND  VISABOOKING_PURCHASEDETAILS.BOOKING_YEARID = VISABOOKING.BOOKING_YEARID WHERE  (VISABOOKING_PURCHASEDETAILS.BOOKING_BALANCE > 0) UNION ALL SELECT INTERNATIONALBOOKINGMASTER.BOOKING_SALEBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, INTERNATIONALBOOKINGMASTER.BOOKING_GRANDTOTAL AS BILLAMT, INTERNATIONALBOOKINGMASTER.BOOKING_SALEBALANCE AS BALAMT, 'INTERNATIONAL' AS TYPE, BOOKING_NO AS BILLNO, BOOKING_CMPID AS CMPID, BOOKING_LOCATIONID AS LOCATIONID, BOOKING_YEARID AS YEARID FROM INTERNATIONALBOOKINGMASTER INNER JOIN LEDGERS ON INTERNATIONALBOOKINGMASTER.BOOKING_LEDGERID = LEDGERS.Acc_id WHERE BOOKING_CANCELLED = 'FALSE' AND BOOKING_AMD_DONE ='FALSE' AND INTERNATIONALBOOKINGMASTER.BOOKING_SALEBALANCE >  0  UNION ALL SELECT INTERNATIONALBOOKINGMASTER_PURCHASEDETAILS.BOOKING_PURBILLINITIALS AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, INTERNATIONALBOOKINGMASTER_PURCHASEDETAILS.BOOKING_GTOTAL AS BILLAMT, INTERNATIONALBOOKINGMASTER_PURCHASEDETAILS.BOOKING_BALANCE AS BALAMT, 'INTERNATIONAL' AS TYPE, INTERNATIONALBOOKINGMASTER.BOOKING_NO AS BILLNO , INTERNATIONALBOOKINGMASTER.BOOKING_CMPID AS CMPID, INTERNATIONALBOOKINGMASTER.BOOKING_LOCATIONID AS LOCATIONID, INTERNATIONALBOOKINGMASTER.BOOKING_YEARID AS YEARID FROM LEDGERS INNER JOIN INTERNATIONALBOOKINGMASTER_PURCHASEDETAILS ON LEDGERS.Acc_id = INTERNATIONALBOOKINGMASTER_PURCHASEDETAILS.BOOKING_PURLEDGERID INNER JOIN INTERNATIONALBOOKINGMASTER ON INTERNATIONALBOOKINGMASTER_PURCHASEDETAILS.BOOKING_NO = INTERNATIONALBOOKINGMASTER.BOOKING_NO AND INTERNATIONALBOOKINGMASTER_PURCHASEDETAILS.BOOKING_YEARID = INTERNATIONALBOOKINGMASTER.BOOKING_YEARID WHERE INTERNATIONALBOOKINGMASTER.BOOKING_CANCELLED = 'FALSE' AND INTERNATIONALBOOKINGMASTER.BOOKING_AMD_DONE ='FALSE' AND INTERNATIONALBOOKINGMASTER_PURCHASEDETAILS.BOOKING_BALANCE > 0 UNION ALL SELECT ISNULL(MISCPURMASTER.BOOKING_PURBILLINITIALS, '') AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, MISCPURMASTER.BOOKING_PURGRANDTOTAL AS BILLAMT, MISCPURMASTER.BOOKING_PURBALANCE AS BALAMT, 'MISCPUR' AS TYPE, MISCPURMASTER.BOOKING_NO AS BILLNO, MISCPURMASTER.BOOKING_CMPID AS CMPID, MISCPURMASTER.BOOKING_LOCATIONID AS LOCATIONID, MISCPURMASTER.BOOKING_YEARID AS YEARID FROM MISCPURMASTER INNER JOIN LEDGERS ON MISCPURMASTER.BOOKING_PURLEDGERID = LEDGERS.Acc_id WHERE  MISCPURMASTER.BOOKING_CANCELLED='FALSE' AND MISCPURMASTER.BOOKING_PURBALANCE > 0 UNION ALL SELECT     ISNULL(MISCSALMASTER.BOOKING_PURBILLINITIALS, '') AS SRNO, '' AS GUESTNAME, LEDGERS.Acc_cmpname AS NAME, MISCSALMASTER.BOOKING_PURGRANDTOTAL AS BILLAMT, MISCSALMASTER.BOOKING_PURBALANCE AS BALAMT, 'MISCSALE' AS TYPE, MISCSALMASTER.BOOKING_NO AS BILLNO, MISCSALMASTER.BOOKING_CMPID AS CMPID, MISCSALMASTER.BOOKING_LOCATIONID AS LOCATIONID, MISCSALMASTER.BOOKING_YEARID AS YEARID FROM MISCSALMASTER INNER JOIN LEDGERS ON MISCSALMASTER.BOOKING_PURLEDGERID = LEDGERS.Acc_id WHERE  MISCSALMASTER.BOOKING_CANCELLED ='FALSE' AND MISCSALMASTER.BOOKING_PURBALANCE > 0) AS T ", tepmcondition & " AND T.BALAMT > 0 AND T.CMPID = " & CmpId & " AND T.LOCATIONID = " & Locationid & " AND T.YEARID =" & YearId & " ORDER BY T.TYPE, T.BILLNO ")
            griddetails.DataSource = dt
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub SelectBills_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        Try
            Receipt.SELECTEDBILLNO = ""
            Dim CONDITION As String = ""
            If CMPNAME <> "" Then CONDITION = " AND T.NAME = '" & CMPNAME & "' "
            fillgrid(CONDITION)
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub gridrec_DoubleClick(ByVal sender As Object, ByVal e As System.EventArgs) Handles gridrec.DoubleClick
        Try
            cmdok_Click(sender, e)
        Catch ex As Exception
            Throw ex
        End Try
    End Sub
End Class